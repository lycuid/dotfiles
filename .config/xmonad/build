#!/bin/sh

set -e
BIN=$1

cabal clean
if $(find . ! -type d | cut -d\/ -f2- | stest -qn "$BIN");
then
  echo "[+] binary output => $BIN"

  cabal build
  find dist-newstyle -type f -name xmonad-bin | xargs -i mv {} "$BIN"
  cabal clean
  strip "$BIN"

  echo "[+] successfully compiled xmonad."
fi
